---
# ============================================
# NAMESPACE
# ============================================
apiVersion: v1
kind: Namespace
metadata:
  name: video-pipeline
  labels:
    name: video-pipeline
    environment: production

---
# ============================================
# CONFIGMAP - Configuration centralisée
# ============================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: video-pipeline-config
  namespace: video-pipeline
data:
  # Variables d'environnement communes
  PYTHONUNBUFFERED: "1"
  PYTHONDONTWRITEBYTECODE: "1"
  LOG_LEVEL: "INFO"
  
  # Chemins internes
  UPLOADS_DIR: "/data/uploads"
  DATA_DIR: "/data"
  OUTPUTS_DIR: "/data/outputs"
  
  # Configuration services
  DEVICE: "cpu"  # Changer en "cuda" pour GPU
  FFMPEG_PATH: "/usr/bin/ffmpeg"
  
  # Timeouts (secondes)
  PROCESSING_TIMEOUT: "1800"
  DOWNLOAD_TIMEOUT: "600"

---
# ============================================
# SECRET - Credentials sensibles
# ============================================
apiVersion: v1
kind: Secret
metadata:
  name: video-pipeline-secrets
  namespace: video-pipeline
type: Opaque
stringData:
  # Génère avec: echo -n "your-secret-key" | base64
  REDIS_PASSWORD: ""
  DATABASE_URL: "sqlite:///./database/local_db.json"
  API_KEY: "your-api-key-here"

---
# ============================================
# PersistentVolumeClaim - SHARED DATA
# ============================================
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: shared-data-pvc
  namespace: video-pipeline
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: standard
  resources:
    requests:
      storage: 100Gi

---
# ============================================
# PersistentVolumeClaim - OUTPUTS
# ============================================
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: merger-outputs-pvc
  namespace: video-pipeline
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: standard
  resources:
    requests:
      storage: 50Gi

---
# ============================================
# PersistentVolumeClaim - REDIS DATA
# ============================================
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: redis-data-pvc
  namespace: video-pipeline
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: standard
  resources:
    requests:
      storage: 10Gi
